<div class="space-y-6 animate-fade-in">
    <!-- Account Settings -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <%= ui_card class: "p-6 h-full" do %>
            <h3 class="font-bold text-lg text-gray-900 mb-4">Account</h3>
            <%= form_with url: update_account_settings_path, method: :post, local: true, class: "space-y-4" do |f| %>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" name="user[email]" value="<%= @user_settings.email %>" class="input-standard" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                    <input type="password" name="current_password" placeholder="••••••••" class="input-standard" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                    <input type="password" name="new_password" placeholder="••••••••" class="input-standard" />
                </div>
                 <div class="flex justify-end pt-2">
                    <button class="btn-primary w-full">Update Account</button>
                </div>
            <% end %>
        <% end %>
        
        <%= ui_card class: "p-6 h-full" do %>
            <h3 class="font-bold text-lg text-gray-900 mb-4">Preferences</h3>
            <%= form_with url: settings_path, method: :patch, local: true, class: "space-y-4" do |f| %>
                 <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
                    <select name="user[timezone]" class="input-standard">
                        <option value="America/New_York" <%= 'selected' if @user_settings.timezone == 'America/New_York' %>>Eastern Time (ET)</option>
                        <option value="America/Chicago" <%= 'selected' if @user_settings.timezone == 'America/Chicago' %>>Central Time (CT)</option>
                        <option value="America/Los_Angeles" <%= 'selected' if @user_settings.timezone == 'America/Los_Angeles' %>>Pacific Time (PT)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date Format</label>
                     <select name="user[date_format]" class="input-standard">
                        <option value="MM/DD/YYYY" <%= 'selected' if @user_settings.date_format == 'MM/DD/YYYY' %>>MM/DD/YYYY</option>
                        <option value="DD/MM/YYYY" <%= 'selected' if @user_settings.date_format == 'DD/MM/YYYY' %>>DD/MM/YYYY</option>
                        <option value="YYYY-MM-DD" <%= 'selected' if @user_settings.date_format == 'YYYY-MM-DD' %>>YYYY-MM-DD</option>
                    </select>
                </div>
                <div class="flex justify-end pt-2">
                    <button class="btn-primary w-full">Save Changes</button>
                </div>
            <% end %>
        <% end %>
        
         <%= ui_card class: "p-6 h-full" do %>
            <h3 class="font-bold text-lg text-gray-900 mb-4">Subscription</h3>
             <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-500">Status:</span>
                    <span class="font-semibold text-emerald-600"><%= @subscription_active ? 'Active' : 'Inactive' %></span>
                </div>
                <div class="flex justify-between">
                     <span class="text-gray-500">Period:</span>
                     <span class="font-medium capitalize"><%= @user_settings.subscription_period || 'Monthly' %></span>
                </div>
                <div class="flex justify-between">
                     <span class="text-gray-500">Cost:</span>
                     <span class="font-medium"><%= number_to_currency((@user_settings.subscription_price_cents || 1000) / 100.0) %>/<%= (@user_settings.subscription_period == 'yearly' ? 'yr' : 'mo') %></span>
                </div>
                
                <div class="bg-blue-50 border border-blue-100 rounded-lg p-3 mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700 font-medium">Switch to Annual</span>
                        <span class="text-blue-600 font-bold text-xs">Save 30%</span>
                    </div>
                    <button class="w-full py-1.5 bg-white border border-gray-200 text-gray-700 rounded text-xs font-medium hover:bg-gray-50">Switch Plan</button>
                </div>
                 <div class="flex gap-2 mt-2">
                    <button class="flex-1 py-1.5 bg-gray-100 text-gray-600 rounded text-xs font-medium hover:bg-gray-200">Renew</button>
                     <button class="flex-1 py-1.5 bg-red-50 text-red-600 rounded text-xs font-medium hover:bg-red-100">Cancel</button>
                </div>
             </div>
        <% end %>
    </div>
    
    <!-- Referral -->
    <%= ui_card class: "p-6 bg-blue-50 border-blue-100" do %>
         <h3 class="font-bold text-lg text-blue-900 mb-2">Referral Program</h3>
         <p class="text-sm text-blue-700 mb-4">Share your referral link and earn rewards. Get 3 months free for each sign up.</p>
         <div class="flex gap-2">
            <input readonly value="<%= request.base_url %>/signup?ref=<%= @referral_code %>" class="flex-1 p-2 border border-blue-200 rounded-lg text-sm bg-white text-gray-600" />
            <button class="btn-primary bg-blue-600 hover:bg-blue-700">Copy</button>
         </div>
    <% end %>
    
     <!-- Feedback -->
     <%= ui_card class: "p-6" do %>
         <h3 class="font-bold text-lg text-gray-900 mb-4">Feedback</h3>
         <%= form_with url: feedback_settings_path, method: :post, local: true, class: "space-y-4" do |f| %>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">How likely are you to recommend us? (0-10)</label>
                <select name="feedback[rating_net_promoter]" class="input-standard">
                    <option value="">Select a score</option>
                    <% (0..10).each do |num| %>
                        <option value="<%= num %>"><%= num %></option>
                    <% end %>
                </select>
            </div>
             <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Additional Comments</label>
                <textarea name="feedback[message]" rows="3" class="input-standard" placeholder="Share your thoughts..."></textarea>
            </div>
            <div class="flex justify-end">
                <button class="btn-primary">Submit Feedback</button>
            </div>
         <% end %>
     <% end %>

    <!-- Export History -->
    <%= ui_card class: "overflow-hidden" do %>
        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
            <h3 class="font-bold text-lg text-gray-900">Export History</h3>
            <%= button_to export_data_settings_path, method: :post, class: "btn-primary" do %>
                 Export Data
            <% end %>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500 font-medium">
                    <tr>
                        <th class="px-6 py-3">Filename</th>
                        <th class="px-6 py-3">Date</th>
                        <th class="px-6 py-3 text-right">Action</th>
                    </tr>
                </thead>
                 <tbody class="divide-y divide-gray-100">
                    <% if @data_files.any? %>
                        <% @data_files.each do |file| %>
                            <tr class="hover:bg-gray-50/50">
                                <td class="px-6 py-3 text-gray-900"><%= file.filename %></td>
                                <td class="px-6 py-3 text-gray-500"><%= file.created_at.strftime('%Y-%m-%d %H:%M') %></td>
                                <td class="px-6 py-3 text-right">
                                    <%= link_to "Download", download_data_file_settings_path(id: file.id), class: "text-blue-600 hover:text-blue-800 font-medium" %>
                                </td>
                            </tr>
                        <% end %>
                    <% else %>
                        <tr><td colspan="3" class="p-6 text-center text-gray-500">No export history yet.</td></tr>
                    <% end %>
                 </tbody>
            </table>
        </div>
    <% end %>
    
    <!-- Delete Account -->
    <%= ui_card class: "p-6 border-red-200 bg-red-50" do %>
        <h3 class="font-bold text-lg text-red-700 mb-2">Delete Account</h3>
        <p class="text-sm text-red-600 mb-4">Warning: This action cannot be undone. All your data will be permanently removed.</p>
         <%= form_with url: destroy_account_settings_path, method: :delete, local: true do |f| %>
             <div class="flex flex-col md:flex-row gap-4 items-end">
                <div class="flex-1 w-full">
                    <label class="block text-sm font-medium text-red-700 mb-1">Enter password to confirm</label>
                    <input type="password" name="password" class="input-standard border-red-200 focus:ring-red-500 focus:border-red-500" placeholder="Password" required />
                </div>
                <button class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 w-full md:w-auto">Delete Account</button>
             </div>
         <% end %>
    <% end %>
</div>
