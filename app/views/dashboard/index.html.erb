<div class="page-header d-flex justify-content-between align-items-start mb-4">
  <div>
    <h1>Dashboard</h1>
    <p>Overview of your financial health</p>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    <%= link_to export_excel_dashboard_index_path, class: "btn btn-primary" do %>
      <i class="bi bi-download"></i> Export to Excel
    <% end %>
    <%= link_to export_pdf_dashboard_index_path, class: "btn btn-primary" do %>
      <i class="bi bi-file-pdf"></i> Export to PDF
    <% end %>
  </div>
</div>

<!-- Dashboard Metrics -->
<div class="card mb-4">
  <div class="card-glow"></div>
  <!-- Card: Top Section (Title) -->
  <div class="card-header">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Financial Overview</h2>
  </div>
  <!-- Card: Bottom Section (Metrics) -->
  <div class="card-body">
    <div class="metrics-grid">
      <!-- Net Worth -->
      <div class="metric-tile">
        <div class="metric-label">Net Worth</div>
        <div class="metric-value">$<%= number_with_delimiter(@net_worth.round(0)) %></div>
        <% if @net_worth_trend.present? %>
          <div class="metric-subtext" style="color: <%= @net_worth_trend >= 0 ? '#6ee7b7' : '#fca5a5' %>;">
            <%= @net_worth_trend >= 0 ? '+' : '' %><%= number_with_precision(@net_worth_trend, precision: 0) %>% this year
          </div>
        <% end %>
      </div>
      
      <!-- Total Assets -->
      <div class="metric-tile">
        <div class="metric-label">Total Assets</div>
        <div class="metric-value">$<%= number_with_delimiter(@total_assets.round(0)) %></div>
        <% if @assets_trend.present? %>
          <div class="metric-subtext" style="color: <%= @assets_trend >= 0 ? '#059669' : '#dc2626' %>;">
            <%= @assets_trend >= 0 ? '+' : '' %><%= number_with_precision(@assets_trend, precision: 0) %>% this year
          </div>
        <% end %>
      </div>
      
      <!-- Total Liabilities -->
      <div class="metric-tile">
        <div class="metric-label">Total Liabilities</div>
        <div class="metric-value">$<%= number_with_delimiter(@total_liabilities.round(0)) %></div>
        <% if @liabilities_trend.present? %>
          <div class="metric-subtext" style="color: <%= @liabilities_trend >= 0 ? '#059669' : '#dc2626' %>;">
            <%= @liabilities_trend >= 0 ? '+' : '' %><%= number_with_precision(@liabilities_trend, precision: 0) %>% this year
          </div>
        <% end %>
      </div>
      
      <!-- Net Monthly Savings -->
      <div class="metric-tile">
        <div class="metric-label">Net Monthly Savings</div>
        <div class="metric-value">$<%= number_with_delimiter(@monthly_savings.round(0)) %></div>
        <div class="metric-subtext">Average</div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-glow"></div>
      <!-- Card: Top Section (Title) -->
      <div class="card-header">
        <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Asset Allocation</h2>
      </div>
      <!-- Card: Bottom Section (Content) -->
      <div class="card-body">
        <% if @asset_allocation.any? %>
          <div class="mb-3">
            <% total_assets = @asset_allocation.values.sum %>
            <% @asset_allocation.sort_by { |_, v| -v }.each do |asset_type, value| %>
              <% percentage = total_assets > 0 ? (value / total_assets * 100) : 0 %>
              <div class="mb-2">
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-sm" style="color: #e5e5e5;"><%= asset_type.humanize %></span>
                  <span class="text-sm font-medium" style="color: #fafafa;"><%= number_with_precision(percentage, precision: 1) %>%</span>
                </div>
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar" role="progressbar" style="width: <%= percentage %>%">
                    $<%= number_with_delimiter(value.round(0)) %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-muted text-center py-5">Add investments to see allocation.</p>
        <% end %>
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-glow"></div>
      <!-- Card: Top Section (Title) -->
      <div class="card-header">
        <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Monthly Trends</h2>
      </div>
      <!-- Card: Bottom Section (Content) -->
      <div class="card-body">
        <% if @monthly_trends.any? %>
          <div class="mb-3">
            <% sorted_trends = @monthly_trends.sort_by { |date, _| date } %>
            <% sorted_trends.last(6).each do |date, data| %>
              <div class="mb-2">
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-sm" style="color: #e5e5e5;"><%= date.strftime('%b %Y') %></span>
                  <span class="text-sm font-medium" style="color: #fafafa;"><strong>$<%= number_with_delimiter(data[:net_worth].round(0)) %></strong></span>
                </div>
                <div class="d-flex justify-content-between small text-muted">
                  <span>Assets: $<%= number_with_delimiter(data[:assets].round(0)) %></span>
                  <span>Liabilities: $<%= number_with_delimiter(data[:liabilities].round(0)) %></span>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-muted text-center py-5">Add monthly updates to see trends.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions Section -->
<div class="card mt-4 quick-actions">
  <div class="card-glow"></div>
  <!-- Card: Top Section (Title) -->
  <div class="card-header">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Quick Actions</h2>
    <p class="text-muted mb-0 text-sm mt-1">Common tasks you may want to perform</p>
  </div>
  <!-- Card: Bottom Section (Content) -->
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3">
        <%= link_to portfolios_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-graph-up" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Portfolio</span>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to accounts_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-piggy-bank" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Savings & Expenses</span>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to loans_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-cash-coin" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Loans</span>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to insurance_policies_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-shield-check" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Insurance</span>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to taxes_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-receipt" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Taxes</span>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to retirements_path, class: "btn btn-outline-primary w-100 d-flex flex-column align-items-center justify-content-center py-3" do %>
          <i class="bi bi-calendar-check" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
          <span>Retirement</span>
        <% end %>
      </div>
    </div>
  </div>
</div>
