<div class="space-y-6 animate-fade-in" data-controller="modal">
    <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold text-gray-900">Tax Years</h2>
        <button type="button" data-action="modal#open" class="btn-primary">
          New Tax Year
        </button>
    </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% if @taxes.any? %>
      <% @taxes.each do |tax| %>
         <% 
            status = tax.tax_paid.to_f > 0 ? 'Filed' : 'Projected'
            paid_color = 'text-red-600'
         %>
        <%= ui_card class: "p-6" do %>
            <div class="flex justify-between items-start mb-4">
              <h3 class="font-bold text-lg text-gray-900">Tax Year <%= tax.year %></h3>
              <div class="flex gap-2 items-center">
                  <%= ui_badge status, type: status == 'Filed' ? :success : :warning %>
                  <%= link_to "Edit", edit_tax_path(tax), class: "text-gray-400 hover:text-blue-600 font-medium text-xs" %>
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <p class="flex justify-between"><span class="text-gray-500">Gross Income</span> <span class="font-medium text-gray-900"><%= number_to_currency(tax.gross_income || 0) %></span></p>
              <p class="flex justify-between"><span class="text-gray-500">Tax Paid</span> <span class="font-medium <%= paid_color %>">-<%= number_to_currency(tax.tax_paid || 0) %></span></p>
              <p class="flex justify-between border-t border-gray-100 pt-2 mt-2">
                  <span class="text-gray-900 font-semibold">Effective Rate</span> 
                  <span class="font-bold text-blue-600">
                      <% rate = (tax.gross_income.to_f > 0 ? (tax.tax_paid.to_f / tax.gross_income.to_f * 100) : 0) %>
                      <%= rate.round(1) %>%
                  </span>
              </p>
            </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="col-span-full text-center py-10 bg-white rounded-2xl border border-gray-200 text-gray-500">
        No tax years found.
      </div>
    <% end %>
  </div>

  <!-- New Tax Modal -->
  <%= render 'shared/modal', title: "New Tax Year", target: "dialog" do %>
    <%= form_with model: @tax, local: true, class: "space-y-4" do |f| %>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :name, "Name", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :name, class: "input-standard", required: true, placeholder: "e.g., 2024 Taxes" %>
        </div>
        <div>
          <%= f.label :year, "Year", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :year, value: Date.today.year, class: "input-standard", required: true %>
        </div>
      </div>
      
       <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :gross_income, "Annual Income", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :gross_income, step: 1, class: "input-standard", required: true %>
        </div>
        <div>
          <%= f.label :deductions, "Deductions", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :deductions, step: 1, class: "input-standard", required: true %>
        </div>
      </div>
      
       <div class="grid grid-cols-2 gap-4">
        <div>
           <%= f.label :taxable_income, "Taxable Income", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :taxable_income, step: 1, class: "input-standard", required: true %>
        </div>
        <div>
           <%= f.label :tax_paid, "Tax Paid", class: "block text-sm font-medium text-gray-700 mb-1" %>
           <%= f.number_field :tax_paid, step: 1, class: "input-standard", required: true %>
        </div>
      </div>
      
       <div>
         <%= f.label :notes, "Notes", class: "block text-sm font-medium text-gray-700 mb-1" %>
         <%= f.text_area :notes, rows: 2, class: "input-standard" %>
      </div>

      <div class="flex justify-end gap-3 pt-4">
        <button type="button" data-action="modal#close" class="btn-secondary">Cancel</button>
        <%= f.submit "Save Tax Year", class: "btn-primary cursor-pointer" %>
      </div>
    <% end %>
  <% end %>
</div>
