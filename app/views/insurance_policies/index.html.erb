<div class="space-y-6 animate-fade-in" data-controller="modal">
    <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold text-gray-900">Insurance Policies</h2>
        <button type="button" data-action="modal#open" class="btn-primary">
          New Policy
        </button>
    </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% if @policies.any? %>
      <% @policies.each do |policy| %>
        <%= ui_card class: "p-6" do %>
            <div class="flex justify-between items-start mb-4">
              <h3 class="font-bold text-lg text-gray-900"><%= (policy.policy_type rescue 'life').to_s.humanize %> Policy</h3>
              <div class="flex gap-2 items-center">
                  <%= link_to "Edit", edit_insurance_policy_path(policy), class: "text-gray-400 hover:text-blue-600 font-medium text-xs" %>
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <p class="flex justify-between"><span class="text-gray-500">Provider</span> <span class="font-medium text-gray-900"><%= policy.provider rescue 'N/A' %></span></p>
              <p class="flex justify-between"><span class="text-gray-500">Coverage</span> <span class="font-medium text-gray-900"><%= number_to_currency(policy.coverage_amount || 0) %></span></p>
              <p class="flex justify-between"><span class="text-gray-500">Premium</span> <span class="font-medium text-gray-900"><%= number_to_currency(policy.premium || 0) %>/mo</span></p>
            </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="col-span-full text-center py-10 bg-white rounded-2xl border border-gray-200 text-gray-500">
        No policies found.
      </div>
    <% end %>
  </div>

  <!-- New Policy Modal -->
  <%= render 'shared/modal', title: "New Insurance Policy", target: "dialog" do %>
    <%= form_with model: @policy, local: true, class: "space-y-4" do |f| %>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :policy_type, "Policy Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :policy_type, options_for_select([['Life', 'life'], ['Health', 'health'], ['Auto', 'auto'], ['Home', 'home']]), {}, class: "input-standard" %>
        </div>
        <div>
          <%= f.label :provider, "Provider", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :provider, class: "input-standard", required: true %>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
         <div>
          <%= f.label :coverage_amount, "Coverage Amount", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :coverage_amount, step: 0.01, class: "input-standard", required: true %>
        </div>
        <div>
          <%= f.label :premium, "Monthly Premium", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :premium, step: 0.01, class: "input-standard", required: true %>
        </div>
      </div>
      
       <div>
        <%= f.label :term_years, "Term (years)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.number_field :term_years, step: 0.25, class: "input-standard", required: true %>
      </div>
      
      <div>
         <%= f.label :notes, "Notes", class: "block text-sm font-medium text-gray-700 mb-1" %>
         <%= f.text_area :notes, rows: 2, class: "input-standard" %>
      </div>

      <div class="flex justify-end gap-3 pt-4">
        <button type="button" data-action="modal#close" class="btn-secondary">Cancel</button>
        <%= f.submit "Save Policy", class: "btn-primary cursor-pointer" %>
      </div>
    <% end %>
  <% end %>
</div>
